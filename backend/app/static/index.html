<!DOCTYPE html>
<html>
<head>
    <title>AI 홈 트레이너</title>
    <link rel="stylesheet" href="/static/index_styles.css">
</head>
<body>
    <h1>AI 홈 트레이너</h1>
    <button id="toggleButton">웹캠 켜기</button>
    <br><br>
    <img id="videoStream" width="640" height="480">

    <script>
        let ws;
        const toggleButton = document.getElementById('toggleButton');
        const videoStream = document.getElementById('videoStream');
        
        // main.py에서 이 부분을 동적으로 교체해줍니다.
        const exercise = "EXERCISE_PLACEHOLDER"; // [!code focus]

        function connectWebSocket() {
            if (ws && ws.readyState === WebSocket.OPEN) { return; }
            
            // 운동 이름에 맞는 웹소켓 주소로 접속
            const wsURL = `ws://localhost:8000/ws/${exercise}`; // [!code focus]    
            console.log("Connecting to:", wsURL); // [!code ++]
            ws = new WebSocket(wsURL); // [!code focus]

            ws.onmessage = (event) => {
                const blob = new Blob([event.data], { type: 'image/jpeg' });
                const url = URL.createObjectURL(blob);
                videoStream.src = url;
            };
            ws.onopen = () => {
                console.log("WebSocket 연결 성공");
                toggleButton.textContent = "웹캠 끄기";
            };
            ws.onclose = () => {
                console.log("WebSocket 연결 종료");
                toggleButton.textContent = "웹캠 켜기";
                videoStream.src = "";
            };
        }

        function disconnectWebSocket() {
            if (ws && ws.readyState === WebSocket.OPEN) { ws.close(); }
        }

        toggleButton.addEventListener('click', () => {
            if (toggleButton.textContent === "웹캠 켜기") {
                connectWebSocket();
            } else {
                disconnectWebSocket();
            }
        });
    </script>
</body>
</html>